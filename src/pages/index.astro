---
import BasePage from "../layouts/BasePage.astro";
import { getCollection } from "astro:content";
import Hero from "../components/layout/Hero";
import FeatureGrid from "../components/layout/FeatureGrid";
import PostCardEnhanced from "../components/blog/PostCardEnhanced";
import { Badge } from "../components/ui/Badge";

// 获取最新文章
const recentPosts = (await getCollection("blog"))
  .sort((a, b) => {
    const aDate = a.data.updatedDate ? a.data.updatedDate.valueOf() : a.data.pubDate.valueOf();
    const bDate = b.data.updatedDate ? b.data.updatedDate.valueOf() : b.data.pubDate.valueOf();
    return bDate - aDate;
  })
  .slice(0, 6); // 增加显示数量

// 统计数据
const totalPosts = (await getCollection("blog")).length;
const uniqueTags = [...new Set((await getCollection("blog")).flatMap(post => post.data.tags || []))].length;
---

<BasePage>
  <!-- Hero 区域 -->
  <Hero />

  <!-- 功能分类网格 -->
  <FeatureGrid />

  <!-- 最新文章区域 -->
  <section id="latest-posts" class="py-16 px-4 sm:px-6 lg:px-8 bg-background/50">
    <div class="max-w-7xl mx-auto">
      {/* 标题区域 */}
      <div class="text-center mb-16">
        <Badge variant="outline" className="mb-4">
          最新发布
        </Badge>
        <h2 class="text-3xl sm:text-4xl lg:text-5xl font-bold mb-4">
          最新
          <span class="bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent ml-3">
            技术文章
          </span>
        </h2>
        <p class="text-lg text-muted-foreground max-w-2xl mx-auto">
          分享最新的技术实践、开发经验和学习心得，
          帮助您在技术道路上不断前进。
        </p>
      </div>

      {/* 文章网格 */}
      <div class="post-card-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 lg:gap-8 mb-12">
        {
          recentPosts.map((post, index) => (
            <PostCardEnhanced
              key={post.id}
              post={post}
              variant={index === 0 ? "featured" : "default"}
            />
          ))
        }
      </div>

      {/* 底部行动按钮 */}
      <div class="button-group text-center">
        <a
          href="/blog"
          class="button-xl inline-flex items-center justify-center px-8 py-3 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors duration-200 font-medium"
        >
          查看所有文章 ({totalPosts}+)
        </a>
      </div>
    </div>
  </section>

  {/* 统计信息区域 */}
  <section class="stats-section py-16 px-4 sm:px-6 lg:px-8 bg-accent/20">
    <div class="max-w-4xl mx-auto text-center">
      <div class="stats-grid grid grid-cols-2 md:grid-cols-4 gap-8">
        <div class="stats-item space-y-2">
          <div class="stats-number text-3xl font-bold text-primary">{totalPosts}+</div>
          <div class="text-sm text-muted-foreground">技术文章</div>
        </div>
        <div class="stats-item space-y-2">
          <div class="stats-number text-3xl font-bold text-primary">{uniqueTags}+</div>
          <div class="text-sm text-muted-foreground">技术分类</div>
        </div>
        <div class="stats-item space-y-2">
          <div class="stats-number text-3xl font-bold text-primary">100+</div>
          <div class="text-sm text-muted-foreground">代码示例</div>
        </div>
        <div class="stats-item space-y-2">
          <div class="stats-number text-3xl font-bold text-primary">∞</div>
          <div class="text-sm text-muted-foreground">持续更新</div>
        </div>
      </div>
    </div>
  </section>
</BasePage>

